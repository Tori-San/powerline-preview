
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

<style>

@font-face{
    font-family: "Hack";
    src: url("fonts/Hack-Regular.ttf");
}

@font-face {
    font-family: "FontAwesome";
    src: url("fonts/fontawesome-webfont.ttf");
}

@font-face {
    font-family: "PowerlineSymbols";
    src: url("fonts/PowerlineSymbols.otf");
}

.ib {
    display: inline-block;
    font-family: FontAwesome, Hack, PowerlineSymbols;
    font-size: 16px;
}

body {
    --l1-fg:#000000;
    --l1-bg:#ffffff;
    --l1-fg-alt:#000000;
    --l1-bg-alt:#ffffff;
    --l1-fg-vis:#000000;
    --l1-bg-vis:#ffffff;
    --l1-fg-rep:#000000;
    --l1-bg-rep:#ffffff;
    --l2-fg:#ffffff;
    --l2-bg:#000000;
    --l2-fg-alt:#ffffff;
    --l2-bg-alt:#000000;
    --l3-fg:#888888;
    --l3-bg:#000000;
    --l3-fg-alt:#888888;
    --l3-bg-alt:#000000;
    --l4-fg:#888888;
    --l4-bg:#000000;
    --l4-fg-alt:#888888;
    --l4-bg-alt:#000000;
    background-color: #252525;
}

div#content {
    position: relative;
    width: 960px;
    left: 50%;
    top: 30px;
    transform: translateX(-50%);
    background-color: #888888;
    border: 20px solid #888888;
}

div#preview_wm {
    position: relative;
}

#preview_placeholder {
    background-color: #aaaaaa;
    width: 960px;
    height: 540px;
    position: relative;
}

#preview_placeholder_text {
    color: #eeeeee;
    font-size: 32px;
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
}

div#preview_l {
    font-size: 0;
    position: absolute;
    bottom: 0;
    left: 0;
}

div#preview_r {
    font-size: 0;
    position: absolute;
    bottom: 0;
    right: 0;
}

div#preview_vim {
    margin-top: 20px;
    font-size: 0;
}

div#vsplit {
    font-family: Hack;
    margin-top: 20px;
    overflow: hidden;
    height: auto;
}

div#selectors {
    float:left;
}

div#output {
    float:right;
    color: #ffffff;
    background-color: #444444;
    border: 20px solid #444444;
}

#current_color {
    margin-top: 10px;
    width: 150px;
    height: 50px;
}

#layer_select {
    margin: 10px 0px 10px 0px;
}
</style>

<div id="content">
    <!-- preview -->
    <div id="preview_wm">
        <div id="preview_placeholder">
            <div id="preview_placeholder_text">select an image</div>
        </div>
        <canvas id="cs" width=960 height=540 style="display:none;"></canvas>
        <div id="preview_l">
            <div class="ib" style="color: var(--l1-fg); background-color: var(--l1-bg);">&thinsp;&#xf0ae;&thinsp;</div>
            <div class="ib" style="color: var(--l1-bg); background-color: var(--l2-bg);">&#xe0b0;&thinsp;</div>
            <div class="ib" style="color: var(--l2-fg); background-color: var(--l2-bg);">1 &#xf268;&thinsp;</div>
            <div class="ib" style="color: var(--l2-bg); background-color: var(--l1-bg);">&#xe0b0;&thinsp;</div>
            <div class="ib" style="color: var(--l1-fg); background-color: var(--l1-bg);">2 &#xf120;&thinsp;</div>
            <div class="ib" style="color: var(--l1-bg); background-color: var(--l2-bg);">&#xe0b0;&thinsp;</div>
            <div class="ib" style="color: var(--l2-fg); background-color: var(--l2-bg);">3 &#xf120;  &#xe0b1;&thinsp;</div>
            <div class="ib" style="color: var(--l3-fg); background-color: var(--l3-bg);">&thinsp;window title&thinsp;</div>
            <div class="ib" style="color: var(--l3-bg);">&#xe0b0;&thinsp;</div>
        </div>
        <div id="preview_r">
            <div class="ib" style="color: var(--l3-bg);">&thinsp;&#xe0b2;</div>
            <div class="ib" style="color: #6688ff; background-color: var(--l3-bg);">&thinsp;42.0&#xb0;C&thinsp;</div>
            <div class="ib" style="color: #719e07; background-color: var(--l3-bg);">&#xe0b3;&thinsp;&thinsp;1%&thinsp;</div>
            <div class="ib" style="color: #719e07; background-color: var(--l3-bg);">&#xe0b3;&thinsp;&thinsp;69% @ Wifi&thinsp;</div>
            <div class="ib" style="color: var(--l2-fg); background-color: var(--l2-bg);">&#xe0b3; Dec 25</div>
            <div class="ib" style="color: var(--l1-bg); background-color: var(--l2-bg);">&thinsp;&#xe0b2;</div>
            <div class="ib" style="color: var(--l1-fg); background-color: var(--l1-bg);">&thinsp;13:37&thinsp;</div>
        </div>
    </div>

    <div id="preview_vim">
        <div>
            <div class="ib" style="color: var(--l1-fg); background-color: var(--l1-bg);">&thinsp;NORMAL&thinsp;</div>
            <div class="ib" style="color: var(--l1-bg); background-color: var(--l2-bg);">&#xe0b0;&thinsp;</div>
            <div class="ib" style="color: var(--l2-fg); background-color: var(--l2-bg);">&thinsp;master &#xe0b1;&thinsp;</div>
            <div class="ib" style="color: var(--l3-fg); background-color: var(--l3-bg);">&thinsp;preview.html&thinsp;</div>
            <div class="ib" style="color: var(--l3-bg);">&#xe0b0;&thinsp;</div>
        </div>
        <div style="margin-top: 5px;">
            <div class="ib" style="color: var(--l1-fg-alt); background-color: var(--l1-bg-alt);">&thinsp;INSERT&thinsp;</div>
            <div class="ib" style="color: var(--l1-bg-alt); background-color: var(--l2-bg-alt);">&#xe0b0;&thinsp;</div>
            <div class="ib" style="color: var(--l2-fg-alt); background-color: var(--l2-bg-alt);">&thinsp;master &#xe0b1;&thinsp;</div>
            <div class="ib" style="color: var(--l3-fg-alt); background-color: var(--l3-bg-alt);">&thinsp;preview.html&thinsp;</div>
            <div class="ib" style="color: var(--l3-bg-alt);">&#xe0b0;&thinsp;</div>
        </div>
        <div style="margin-top: 5px;">
            <div class="ib" style="color: var(--l1-fg-vis); background-color: var(--l1-bg-vis);">&thinsp;VISUAL&thinsp;</div>
            <div class="ib" style="color: var(--l1-bg-vis); background-color: var(--l2-bg-alt);">&#xe0b0;&thinsp;</div>
            <div class="ib" style="color: var(--l2-fg-alt); background-color: var(--l2-bg-alt);">&thinsp;master &#xe0b1;&thinsp;</div>
            <div class="ib" style="color: var(--l3-fg-alt); background-color: var(--l3-bg-alt);">&thinsp;preview.html&thinsp;</div>
            <div class="ib" style="color: var(--l3-bg-alt);">&#xe0b0;&thinsp;</div>
        </div>
        <div style="margin-top: 5px;">
            <div class="ib" style="color: var(--l1-fg-rep); background-color: var(--l1-bg-rep);">&thinsp;RPLACE&thinsp;</div>
            <div class="ib" style="color: var(--l1-bg-rep); background-color: var(--l2-bg-alt);">&#xe0b0;&thinsp;</div>
            <div class="ib" style="color: var(--l2-fg-alt); background-color: var(--l2-bg-alt);">&thinsp;master &#xe0b1;&thinsp;</div>
            <div class="ib" style="color: var(--l3-fg-alt); background-color: var(--l3-bg-alt);">&thinsp;preview.html&thinsp;</div>
            <div class="ib" style="color: var(--l3-bg-alt);">&#xe0b0;&thinsp;</div>
        </div>
    </div>

    <div id="vsplit">
        <div id="selectors">
            <div id="img_upload">
                <input type="file" id="imgsrc" accept=".jpg, .jpeg, .png"/>
            </div>
            <input type=color id="current_color">
            <form id="layer_select">
                <input type="radio" name="level" value="--l1-fg" checked="checked">Level 1: foreground
                </br>
                <input type="radio" name="level" value="--l1-bg">Level 1: background
                </br>
                <input type="radio" name="level" value="--l1-fg-alt" style="margin-top: 10px;">Level 1: foreground (alt)
                </br>
                <input type="radio" name="level" value="--l1-bg-alt">Level 1: background (alt)
                </br>
                <input type="radio" name="level" value="--l1-fg-vis" style="margin-top: 10px;">Level 1: foreground (vis)
                </br>
                <input type="radio" name="level" value="--l1-bg-vis">Level 1: background (vis)
                </br>
                <input type="radio" name="level" value="--l1-fg-rep" style="margin-top: 10px;">Level 1: foreground (rep)
                </br>
                <input type="radio" name="level" value="--l1-bg-rep">Level 1: background (rep)
                </br>
                <input type="radio" name="level" value="--l2-fg" style="margin-top: 10px;">Level 2: foreground
                </br>
                <input type="radio" name="level" value="--l2-bg">Level 2: background
                </br>
                <input type="radio" name="level" value="--l2-fg-alt" style="margin-top: 10px;">Level 2: foreground (alt)
                </br>
                <input type="radio" name="level" value="--l2-bg-alt">Level 2: background (alt)
                </br>
                <input type="radio" name="level" value="--l3-fg" style="margin-top: 10px;">Level 3: foreground
                </br>
                <input type="radio" name="level" value="--l3-bg">Level 3: background
                </br>
                <input type="radio" name="level" value="--l3-fg-alt" style="margin-top: 10px;">Level 3: foreground (alt)
                </br>
                <input type="radio" name="level" value="--l3-bg-alt">Level 3: background (alt)
                </br>
                <input type="radio" name="level" value="--l4-fg" style="margin-top: 10px;">Level 4: foreground
                </br>
                <input type="radio" name="level" value="--l4-bg">Level 4: background
                </br>
                <input type="radio" name="level" value="--l4-fg-alt" style="margin-top: 10px;">Level 4: foreground (alt)
                </br>
                <input type="radio" name="level" value="--l4-bg-alt">Level 4: background (alt)
                </br>
            </form>
        </div>
        <div id="output">
        </div>
    </div>
</div>

<script>

var selected_color = "#000000";
var selected_layer = "--l1-fg";

function img_upload_handler(e) {
    var reader = new FileReader();
    var f = e.target.files.item(0);

    reader.onload = function(e) {
        $("#preview_placeholder").hide();
        var canvas = $("#cs");
        canvas.show();
        var img = new Image();
        img.setAttribute("src", e.target.result);
        img.addEventListener("load", function() {
            canvas[0].getContext("2d").drawImage(
                img, 0, 0, img.width, img.height,
                0, 0, canvas[0].width, canvas[0].height
            );
        });
    }

    reader.readAsDataURL(f);
}

function update_preview() {
    $("#current_color").val(selected_color);

    $("body").css(selected_layer, selected_color);

    $("#output").html(
        "level1_fg: '" + $("body").css("--l1-fg") + "'<br />" +
        "level1_bg: '" + $("body").css("--l1-bg") + "'<br />" +
        "<br />" +
        "level1_fg_alt: '" + $("body").css("--l1-fg-alt") + "'<br />" +
        "level1_bg_alt: '" + $("body").css("--l1-bg-alt") + "'<br />" +
        "<br />" +
        "level1_fg_vis: '" + $("body").css("--l1-fg-vis") + "'<br />" +
        "level1_bg_vis: '" + $("body").css("--l1-bg-vis") + "'<br />" +
        "<br />" +
        "level1_fg_rep: '" + $("body").css("--l1-fg-rep") + "'<br />" +
        "level1_bg_rep: '" + $("body").css("--l1-bg-rep") + "'<br />" +
        "<br />" +
        "level2_fg: '" + $("body").css("--l2-fg") + "'<br />" +
        "level2_bg: '" + $("body").css("--l2-bg") + "'<br />" +
        "<br />" +
        "level2_fg_alt: '" + $("body").css("--l2-fg-alt") + "'<br />" +
        "level2_bg_alt: '" + $("body").css("--l2-bg-alt") + "'<br />" +
        "<br />" +
        "level3_fg: '" + $("body").css("--l3-fg") + "'<br />" +
        "level3_bg: '" + $("body").css("--l3-bg") + "'<br />" +
        "<br />" +
        "level3_fg_alt: '" + $("body").css("--l3-fg-alt") + "'<br />" +
        "level3_bg_alt: '" + $("body").css("--l3-bg-alt") + "'<br />" +
        "<br />" +
        "level4_fg: '" + $("body").css("--l4-fg") + "'<br />" +
        "level4_bg: '" + $("body").css("--l4-bg") + "'<br />" +
        "<br />" +
        "level4_fg_alt: '" + $("body").css("--l4-fg-alt") + "'<br />" +
        "level4_bg_alt: '" + $("body").css("--l4-bg-alt") + "'<br />" +
        "<br />"
    );
}

$("#cs").on("click", function(e) {
    var offset = $("#cs").offset();
    var pos = {x: e.pageX - offset.left, y: e.pageY - offset.top};
    var context = this.getContext('2d');
    var rgb = context.getImageData(pos.x, pos.y, 1, 1).data;

    selected_color = "#" +
        ("0" + rgb[0].toString(16)).slice(-2) +
        ("0" + rgb[1].toString(16)).slice(-2) +
        ("0" + rgb[2].toString(16)).slice(-2);

    update_preview();
});

$("#imgsrc").click(function() {
    $(this).val("");
});

$("#imgsrc").on("change", img_upload_handler);

$("#current_color").on("input", function() {
    selected_color = $("#current_color").val();
    update_preview();
})

$("input[name=level]").on("input", function() {
    selected_layer = $("input[name=level]:checked").val();
    selected_color = $("body").css(selected_layer);
    update_preview();
});

update_preview();
</script>
